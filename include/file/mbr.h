/**
 * @file mbr.h
 * @author çœŸç†ã®å¾¡é­‚æœ€è–éº»åŸå½°æ™ƒå°Šå¸« (sonshi@aum.or.jp)
 * @brief ãƒã‚¹ã‚¿ãƒ¼ãƒ–ãƒ¼ãƒˆãƒ¬ã‚³ãƒ¼ãƒ‰ã®å®šç¾©
 * @version 0.1
 * @date 2023-01-03
 * @since 0.1
 * @see https://ja.wikipedia.org/wiki/%E3%83%9E%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%96%E3%83%BC%E3%83%88%E3%83%AC%E3%82%B3%E3%83%BC%E3%83%89
 *
 * @copyright Copyleft ğŸ„¯ 199X çœŸç†ã®å¾¡é­‚æœ€è–éº»åŸå½°æ™ƒå°Šå¸« All Wrongs Reversed.
 *
 */

#ifndef __MBR__H__
#define __MBR__H__

#include <stdint.h>

/**
 * @brief è«–ç†ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³
 *
 */
typedef struct _partition
{
    uint8_t status;             /**< ãƒ–ãƒ¼ãƒˆãƒ•ãƒ©ã‚°(0x80=ãƒ–ãƒ¼ãƒˆå¯/0x00=ãƒ–ãƒ¼ãƒˆä¸å¯) */
    uint8_t chsStartHead;       /**< ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³æœ€åˆã®ã‚»ã‚¯ã‚¿(ãƒ˜ãƒƒãƒ‰) @note ãŠãã‚‰ãä½¿ã‚ã‚Œãªã„ */
    uint8_t chsStartSector;     /**< ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³æœ€åˆã®ã‚»ã‚¯ã‚¿(ã‚·ãƒªãƒ³ãƒ€ä¸Šä½2ãƒ“ãƒƒãƒˆã¨ã‚»ã‚¯ã‚¿) @note ãŠãã‚‰ãä½¿ã‚ã‚Œãªã„ */
    uint8_t chsStartCylinder;   /**< ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³æœ€åˆã®ã‚»ã‚¯ã‚¿(ã‚·ãƒªãƒ³ãƒ€ä¸‹ä½8ãƒ“ãƒƒãƒˆ) @note ãŠãã‚‰ãä½¿ã‚ã‚Œãªã„ */
    uint8_t partitionType;      /**< ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã®ç¨®é¡ */
    uint8_t chsEndHead;         /**< ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³æœ€å¾Œã®ã‚»ã‚¯ã‚¿(ãƒ˜ãƒƒãƒ‰) @note ãŠãã‚‰ãä½¿ã‚ã‚Œãªã„ */
    uint8_t chsEndSector;       /**< ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³æœ€å¾Œã®ã‚»ã‚¯ã‚¿(ã‚·ãƒªãƒ³ãƒ€ä¸Šä½2ãƒ“ãƒƒãƒˆã¨ã‚»ã‚¯ã‚¿) @note ãŠãã‚‰ãä½¿ã‚ã‚Œãªã„ */
    uint8_t chsEndCylinder;     /**< ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³æœ€å¾Œã®ã‚»ã‚¯ã‚¿(ã‚·ãƒªãƒ³ãƒ€ä¸‹ä½8ãƒ“ãƒƒãƒˆ) @note ãŠãã‚‰ãä½¿ã‚ã‚Œãªã„ */
    uint32_t startLBASector;    /**< ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã®æœ€åˆã®ã‚»ã‚¯ã‚¿(LBA) */
    uint32_t sectors;           /**< ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã®ã‚»ã‚¯ã‚¿æ•°(LBA) @note é€šå¸¸1LBAã¯512Bãªã®ã§1ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã§ã¯512*(2^32)BãŒä¸Šé™ã«ãªã‚‹ */

} __attribute__((packed)) partition;

/**
 * @brief ãƒã‚¹ã‚¿ãƒ¼ãƒ–ãƒ¼ãƒˆãƒ¬ã‚³ãƒ¼ãƒ‰
 *
 */
typedef struct _mbr
{
    uint8_t code[446];      /**< ãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—ãƒ­ãƒ¼ãƒ€ */
    partition partition1;   /**< ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³1 */
    partition partition2;   /**< ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³2 */
    partition partition3;   /**< ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³3 */
    partition partition4;   /**< ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³4 */
    uint16_t signature;     /**< ã‚·ã‚°ãƒãƒãƒ£(0xAA55) */

} __attribute__((packed)) mbr;

#endif
